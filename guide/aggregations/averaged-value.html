

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Averaged value &mdash; Algebird Documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Algebird Documentation" href="../index.html"/>
        <link rel="up" title="Aggregations" href="../aggregations.html"/>
        <link rel="next" title="Bloom filter" href="bloom-filter.html"/>
        <link rel="prev" title="Approximate" href="approximate.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> Algebird</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Abstract algebra basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics.html#semigroups">Semigroups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html#monoids">Monoids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html#groups">Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html#rings">Rings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html#fields">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html#vector-space">Vector space</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../aggregations.html">Aggregations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="approximate.html">Approximate</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Averaged value</a></li>
<li class="toctree-l2"><a class="reference internal" href="bloom-filter.html">Bloom filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="countmin-sketch.html">Count-min sketch</a></li>
<li class="toctree-l2"><a class="reference internal" href="decayed-value.html">Decayed value</a></li>
<li class="toctree-l2"><a class="reference internal" href="decayed-vector.html">Decayed vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperloglog.html">HyperLogLog</a></li>
<li class="toctree-l2"><a class="reference internal" href="space-saver.html">Space-Saver</a></li>
<li class="toctree-l2"><a class="reference internal" href="top-k.html">Top-K</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../summing.html">Miscellaneous summing utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../summing.html#summingqueue">SummingQueue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../summing.html#summingiterator">SummingIterator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../summing.html#summingcache">SummingCache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stateful-summing.html">Stateful summing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stateful-summing.html#sumall">SumAll</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stateful-summing.html#bufferedsumall">BufferedSumAll</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Algebird</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../aggregations.html">Aggregations</a> &raquo;</li>
      
    <li>Averaged value</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="averaged-value">
<span id="id1"></span><h1>Averaged value</h1>
<p>The <tt class="docutils literal"><span class="pre">AveragedValue</span></tt> group is a simple group which allows you to think of computing the mean across a group of numbers
just as you would computing the sum via addition.  For example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">sample</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="k">val</span> <span class="n">average</span> <span class="k">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">num</span> <span class="k">=&gt;</span> <span class="nc">AveragedValue</span><span class="o">(</span><span class="n">num</span><span class="o">)</span> <span class="o">}.</span><span class="n">reduce</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">).</span><span class="n">value</span>
<span class="c1">// returns 4.8</span>
</pre></div>
</div>
<p>The trick is to wrap your <tt class="docutils literal"><span class="pre">Double</span></tt> values with an instance of <tt class="docutils literal"><span class="pre">AveragedValue</span></tt>.  The implicit group will be found within
the companion object of <tt class="docutils literal"><span class="pre">AveragedValue</span></tt> and your instances will combine using <tt class="docutils literal"><span class="pre">+</span></tt> like any other Algebird aggregation.</p>
<div class="section" id="considerations-for-large-data-sets">
<h2>Considerations for large data sets</h2>
<p>We all learned in school that the mean or average is equal to the sum of the values divided by the count of values.
Unfortunatly this approach can lead to accumulated rounding errors when computing averages in parallel across a cluster
as is often the case when using Algebird on Hadoop.</p>
<p>To address this, the <tt class="docutils literal"><span class="pre">AveragedValue</span></tt> group uses an algorithm
that is more stable across a large number of samples (read more <a class="reference external" href="http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Parallel_algorithm">on Wikipedia</a>).</p>
<p>See below for a demonstration:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">sample</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span>
  <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
  <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span>
  <span class="mi">8</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
  <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span>
  <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span>
<span class="o">)</span>

<span class="k">val</span> <span class="n">naiveAverage</span> <span class="k">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">reduce</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span> <span class="o">/</span> <span class="n">sample</span><span class="o">.</span><span class="n">size</span>
<span class="c1">// returns 5.29</span>

<span class="k">import</span> <span class="nn">com.twitter.algebird.Operators._</span> <span class="c1">// override `+`</span>
<span class="k">val</span> <span class="n">algebirdAverage</span> <span class="k">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="nc">AveragedValue</span><span class="o">(</span><span class="k">_</span><span class="o">)).</span><span class="n">reduce</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">).</span><span class="n">value</span>
<span class="c1">// returns 5.289999999999999</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bloom-filter.html" class="btn btn-neutral float-right" title="Bloom filter">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="approximate.html" class="btn btn-neutral" title="Approximate"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2014, Twitter Inc.
      Last updated on Apr 30, 2014.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.6.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>